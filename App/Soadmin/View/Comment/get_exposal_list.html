<include file="Public/header" />
<body onload="on_load()">
<style>
.sub
{
    background:#C0C0C0;
    text-align: center;
}
.ssub
{
    background:#EEDFCC;
    text-align: center;
}
</style>
<script src="__PUBLIC__/Soadmin/js/treeTable/jquery.treeTable.js" type="text/javascript"></script>
<form name="fom" id="fom" method="get">
<table id="mainpage" width="100%" border="0" cellspacing="0" cellpadding="0">
  <include file="Comment/search_exposal"/>
  <tr>
    <td><table id="subtree1" style="DISPLAY: " width="100%" border="0" cellspacing="0" cellpadding="0">

        <tr>
          <td><table width="95%" border="0" align="center" cellpadding="0" cellspacing="0">

          	 <tr>
               <td height="20"><span class="newfont07">选择：<a href="#" class="right-font08" onclick="selectAll();">全选</a>-<a href="#" class="right-font08" onclick="unselectAll();">反选</a></span>
	             
	             </td>
          	 </tr>
              <tr>
                <td height="40" class="font42"><table width="100%" border="0" cellpadding="4" cellspacing="1" bgcolor="#464646" class="newfont03">

                  <tr>
                    <td width="3%" height="20" align="center" bgcolor="#EEEEEE">标记</td>
                    <td width="10%" height="20" align="center" bgcolor="#EEEEEE">会员昵称</td>
                    <td width="10%" height="20" align="center" bgcolor="#EEEEEE">曝光入库企业</td>
                    
                    <td width="20%" height="20" align="center" bgcolor="#EEEEEE">主体</td>
                    <td width="20%" height="20" align="center" bgcolor="#EEEEEE">回复</td>
                    <td width="10%" height="20" align="center" bgcolor="#EEEEEE">评论日期</td>
                    <td width="10%" height="20" align="center" bgcolor="#EEEEEE">是否审核</td>
                    <td width="10%" height="20" align="center" bgcolor="#EEEEEE">审核日期</td>
                    <td width="14%" align="center" bgcolor="#EEEEEE">操作</td>
                  </tr>

                  <volist name="list" id="item">
                  <tr align="center" id="{$item.id}" <if condition="0 neq $item['re_sub']['record_count']">haschild="true"</if>>
                    <td bgcolor="#FFFFFF"></td>
                    <td height="20" bgcolor="#FFFFFF">{$item.nickname}</td>
                    <td height="20" bgcolor="#FFFFFF">{$exposal_list[$item['exposal_id']]}</td>
                    <td height="20" bgcolor="#FFFFFF" style="word-break: break-all">
                    {$item.content}                    
                    </td>
                    <td height="20" bgcolor="#FFFFFF" style="word-break: break-all">--</td>
                    <td height="20" bgcolor="#FFFFFF">{$item.add_time|date="Y-m-d H:i:s",###}</td>
                    <td height="20" bgcolor="#FFFFFF">
                    <if condition="0 eq $item['is_validate']">
                    未审核
                    <else />
                    已审核
                    </if>
                    </td>
                    <td height="20" bgcolor="#FFFFFF">
                    <if condition="0 eq $item['validate_time']">
                    --
                    <else />
                    {$item.validate_time|date="Y-m-d H:i:s",###}
                    </if>
                    </td>
                    <td bgcolor="#FFFFFF">
                        <if condition="0 eq $item['is_validate']">
                        <a href="javascript:request_get('__APP__/Soadmin/Comment/validate_exposal/id/{$item.id}');">审核</a
                        </if>
                     </td>
                  </tr>
                  <!--再回复-->
                  <if condition="0 neq $item['sub']['record_count']">
                  <volist name="item.sub.list" id="sub_item">
                  <tr id="{$sub_item.id}"
                        pId="{$sub_item.parent_id}">
                    <td bgcolor="#FFFFFF" class="sub"></td>    
                    <td height="20" bgcolor="#FFFFFF" class="sub">{$sub_item.nickname}</td>
                    <td height="20" bgcolor="#FFFFFF" class="sub">{$exposal_list[$sub_item['exposal_id']]}</td>
                    <td height="20" bgcolor="#FFFFFF" style="word-break: break-all" class="sub">
                    --
                    </td>
                    <td height="20" bgcolor="#FFFFFF" style="word-break: break-all" class="sub">
                    {$sub_item.content}
                    </td>
                    <td height="20" bgcolor="#FFFFFF" class="sub">{$sub_item.add_time|date="Y-m-d H:i:s",###}</td>
                    <td height="20" bgcolor="#FFFFFF" class="sub">
                    <if condition="0 eq $sub_item['is_validate']">
                    未审核
                    <else />
                    已审核
                    </if>
                    </td>
                    <td height="20" bgcolor="#FFFFFF" class="sub">
                    <if condition="0 eq $sub_item['validate_time']">
                    --
                    <else />
                    {$sub_item.validate_time|date="Y-m-d H:i:s",###}
                    </if>
                    </td>
                    <td bgcolor="#FFFFFF" class="sub">
                        <if condition="0 eq $sub_item['is_validate']">
                        <a href="javascript:request_get('__APP__/Soadmin/Comment/validate_exposal/id/{$sub_item.id}');">审核</a
                        </if>
                     </td>
                  </tr>
                  </volist>
                  </if>
                  <!--再回复-->
                  </volist>

                </table></td>
              </tr>
            </table></td>
        </tr>
      </table>
      <table width="95%" border="0" align="center" cellpadding="0" cellspacing="0">
        <tr>
          <td height="6"><img src="__PUBLIC__/Admin/images/spacer.gif" width="1" height="1" /></td>
        </tr>
        <tr>
          <td colspan="5" align="right">{$page}</td>
        </tr>
</table>
</form>

<div id="loadingmsg" style="width:100px; height:18px; top:0px; display:none;">
	<img src="file:///F|/项目管理相关资料/项目管理系统页面/images/loadon.gif" />
</div>

</body>
</html>
<script type='text/javascript'>
$(function(){
    var option = {
        //theme:'vsStyle',
        expandLevel : 1,
        column:0,
        beforeExpand : function($treeTable, id) {
            //判断id是否已经有了孩子节点，如果有了就不再加载，这样就可以起到缓存的作用
            if ($('.' + id, $treeTable).length) { return; }
            //这里的html可以是ajax请求
            /*
            var html = '<tr id="8" pId="'+id+'"><td>5.1</td><td>可以是ajax请求来的内容</td></tr>'
                     + '<tr id="9" pId="'+id+'"><td>5.2</td><td>动态的内容</td></tr>';
            
            $treeTable.addChilds(html);
            */

            
            cur_obj = document.getElementById(id);;
            var pId = 0;
            pId = $("#"+id).attr("pId");
            var cur_url = location.href;
            //判定是否以get_list结尾,否则截断
            var off_last = cur_url.lastIndexOf("html");
            if(4 == cur_url.length- off_last) 
            {
                cur_url += '?';
            }
            cur_url += "&parent_id="+id+"&s_p="+1;
            var next_obj = get_nextsibling(cur_obj);
            jQuery.ajax({  
                                    type:"get",  
                                    url:cur_url,
                                    timeout: 5000,
                                    dataType:"json",
                                    success: function aa(data) {
                                        var html = '';                                        
                                        for(var i= 0; i< data.record_count; i++)
                                        {
                                          var item = data.list[i];
                                          var tr = '<tr id="'+item.id+'" pId="'+item.parent_id+'"">';
                                          var td = ' \
                                            <td class="ssub"> \
                                            <input type="checkbox" name="id[]" value="'+item.id+'|'+item.company_id+'"  \onclick="select_master_comment(this);" /> \
                                            <span> \
                                            '+item.id+'</span> \
                                            </td> \
                                            <td height="20" class="ssub">'+item.user_id+'</td> \
                                            <td height="20" class="ssub">'+item.nickname+'</td> \
                                            <td height="20" class="ssub"> \
                                            ';
                                            td += item.company_name;
                                            td += '</td> \
                                            <td height="20" class="ssub">';
                                            if('005001' == item.type)
                                            {
                                              td += '<font style="color:#d53315">点赞</font>';
                                            }
                                            else if('005002' == item.type)
                                            {
                                              td += '<font style="color:#0086d2">提问</font>';
                                            }
                                            else
                                            {
                                              td += '<font style="color:#008000">加黑</font>';
                                            }
                                            td += '</td> \
                                            <td height="20" class="ssub"> \
                                            </td> \
                                            <td height="20" class="ssub">'+item.content+'</td> \
                                            <td height="20" class="ssub">'+item.add_time+'</td> \
                                            <td height="20" class="ssub">';
                                            if(0 == item.validate_time)
                                            {
                                              td += '--';
                                            }
                                            else
                                            {
                                              td += item.validate_time;
                                            }
                                            td += '</td><td class="ssub">';
                                            if(0 == item.is_validate
                                            && 0 == item.is_delete)
                                            {
                                              td += ' \
                                                <a href="javascript:request_get(\'__APP__/Soadmin/Comment/validate/id/'+item.id+'/parent_id/'+item.parent_id+'/company_id/'+item.company_id+' \');">审核</a> \
                                               ';
                                            }
                                            if(0 == item.is_delete)
                                            {
                                              td += '<a href="javascript:request_get(\'__APP__/Soadmin/Comment/delete/parentid/'+item.parent_id+'/id/'+item.id+'/company_id/'+item.company_id+'/is_validate/'+item.is_validate+'\');" onclick="return \confirmdel(\'确定要删除吗\')">删除</a></td>';
                                            }
                                          tr += td;
                                          tr += '</tr>';
                                          html += tr;
                                        }
                                        //alert(html);
                                        $treeTable.addChilds(html);
                                    },
                                    error:function my_error(data){
                                       alert('失败');
                                    }
            });
        },
        onSelect : function($treeTable, id) {
            window.console && console.log('onSelect:' + id);
        }

    };
    $('#subtree1').treeTable(option);
});
</script>
