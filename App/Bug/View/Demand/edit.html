<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>运营管理系统</title>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/common.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/main.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/jquery-ui-multiselect/css/jquery.multiselect.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/jquery-ui-multiselect/css/jquery.multiselect.filter.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/jquery-ui-multiselect/css/jquery-ui.css" />
    <script type="text/javascript" src="__PUBLIC__/js/jquery-1.8.3.min.js" ></script>
    <script type="text/javascript" src="__PUBLIC__/Home/js/main.js" ></script>
    <script type="text/javascript" src="__PUBLIC__/Home/js/mh_dialog.js" ></script>
    <script type="text/javascript" src="__PUBLIC__/Home/js/jquery.form.js" ></script>
    <script type="text/javascript" src="__PUBLIC__/Home/js/laydate.js"></script>
    <style type="text/css">
     .fankui_tr td{ text-align: center;}
     .duoxuan{top:557px;}
    </style>
    <script type="text/javascript">
        var url_ajax = "__APP__/Demand/feedback_ajax";
        $(function() {
            $("#ajax_lists").delegate(".list-page a", "click", function() {
                var page = $(this).attr("data-page");
                getPage(page);
            })
            getPage(1);

        })
        function getPage(page) {
            var id = "{$edit_info.id}";
            $.get(url_ajax, {id: id, p: page}, function(data) {
                $('#ajax_lists').html(data);
            })
        }
    </script>
</head>
<body>
<div class="container clearfix">
    <div class="main-wrap">

        <div class="crumb-wrap">
            <div class="crumb-list"><i class="icon-font"></i><a target="_top" href="__ROOT__/">首页</a><span class="crumb-step">&gt;</span><a href="index.html">需求列表</a><span class="crumb-step">&gt;</span><span>需求详情</span></div>
        </div>
        <div class="result-wrap">
            <div class="result-content" id="jbxq">
                    <table class="insert-tab" width="100%">
                        <tbody>
                            <tr>
                                <th colspan="2">
                                    <h1 class="xiangq">基本信息</h1>
                                    <if condition="($edit_info.status LT 7) or ($edit_info.status EGT 14)">
                                        <if condition="$edit_info.to_user_id eq $user_id">
                                        <a id="jbxq_edit" href="javascript:void(0);" class="bianj"><i class="icon-font">&#xe065;</i> 编辑</a>
                                        </if>
                                    </if>
                                </th>
                            </tr>
                            <tr>
                                <th width="120">编号：</th>
                                <td>{$edit_info.number}</td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>需求描述：</th>
                                <td>{$edit_info.description}</td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>优先级：</th>
                                <td>
                                    <volist name="priority_list" id="priority">
                                    <if condition="$edit_info.level eq $key">{$priority}</if>
                                    </volist>
                                </td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>所属项目：</th>
                                <td>{$u_map['project'][$edit_info['project_id']]}</td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>完成进度：</th>
                                <td>{$edit_info.status_ex}</td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>任务派发人：</th>
                                <td>{$u_map['admin'][$edit_info['to_user_id']]}</td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>预计上线时间：</th>
                                <td>
                                    <if condition="$edit_info.plan_online eq 1">随时
                                    <elseif condition="$edit_info.plan_online eq 0" />---
                                    <else />
                                    {$edit_info.plan_online_ex}
                                    </if>
                                </td>
                            </tr>
                            <tr>
                                <th>提交人：</th>
                                <td>{$u_map['admin'][$edit_info['create']]}</td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>受理人：</th>
                                <td>
                                    <div>
                                    新需求确认：
                                    <volist name="d_list.1" id="list">
                                        {$list}　
                                    </volist>
                                    </div>
                                    <div>
                                    UI设计：
                                    <volist name="d_list.2" id="list">
                                        {$list}　
                                    </volist>
                                    </div>
                                    <div>
                                    前端html：
                                    <volist name="d_list.3" id="list">
                                        {$list}　
                                    </volist>
                                    </div>
                                    <div>
                                    新需求开发：
                                    <volist name="d_list.4" id="list">
                                        {$list}　
                                    </volist>
                                    </div>
                                    <div>
                                    功能测试：
                                    <volist name="d_list.5" id="list">
                                        {$list}　
                                    </volist>
                                    </div>
                                    <div>
                                    上线确认：{$u_map['admin'][$edit_info['mast_develop']]}　
                                    {$u_map['admin'][$edit_info['mast_product']]}
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>提交时间：</th>
                                <td>{$edit_info.add_time}</td>
                            </tr>
                            <tr>
                                <th>最终上线时间：</th>
                                <td><if condition="$edit_info.last_online eq ''">---
                                <else />
                                {$edit_info.last_online_ex}
                                </if></td>
                            </tr>
                        </tbody>
                    </table>
            </div>
            <div class="result-content" id="jbxq_ex">
                <form class="registerform" name="theForm_jbxq" autocomplete="off" id="theForm_jbxq" action="__URL__/update_jb" method="post" enctype="multipart/form-data">
                    <table class="insert-tab" width="100%">
                        <tbody>
                            <tr>
                                <th colspan="2">
                                    <h1 class="xiangq">基本信息</h1>
                                    <input class="btn btn-primary mr10" value="保存" id="jbxq_edit_ex" name="submit" type="submit">
                                    <input type="hidden" id="id" name="id" value="{$edit_info.id}">
                                    <input type="hidden" id="status" name="status" value="15">
                                </th>
                            </tr>
                            <tr>
                                <th width="120">编号：</th>
                                <td><input class="common-text yinc" readonly="readonly" name="number" size="50" value="{$edit_info.number}"></td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>需求描述：</th>
                                <td><textarea class="wtms" name="description" id="description">{$edit_info.description}</textarea></td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>优先级：</th>
                                <td>
                                    <select name="level" id="level" class="required">
                                        <option value="">请选择</option>
                                        <volist name="priority_list" id="priority">
                                        <option value="{$key}" <if condition="$edit_info.level eq $key">selected="selected"</if>>{$priority}</option>
                                        </volist>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>所属项目：</th>
                                <td>
                                    <select name="project_id" id="project_id" class="required">
                                        <option value="">请选择</option>
                                        <volist name="u_map.project" id="list">
                                        <option value="{$key}" <if condition="$edit_info.project_id eq $key">selected="selected"</if>>{$list}</option>
                                        </volist>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>完成进度：</th>
                                <td>{$edit_info.status_ex}</td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>任务派发人：</th>
                                <td>{$u_map['admin'][$edit_info['to_user_id']]}</td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>预计上线时间：</th>
                                <td>
                                    <if condition="$edit_info.plan_online eq 1">随时
                                    <elsif condition="$edit_info.plan_online eq 0" />---
                                    <else />{$edit_info.plan_online_ex}
                                    </if>
                                </td>
                            </tr>
                            <tr>
                                <th>提交人：</th>
                                <td>{$u_map['admin'][$edit_info['create']]}</td>
                            </tr>
                            <tr>
                                <th><i class="require-red">*</i>受理人：</th>
                                <td>
                                    <div>
                                        <font>新需求确认：</font>
                                        <span>
                                            <button id="c" class="ui-multiselect ui-widget ui-state-default ui-corner-all xinxuq" type="button" aria-haspopup="true" style="min-width: 225px;height:28px;overflow:hidden;">
                                            <span class="ui-icon ui-icon-triangle-1-s"></span>
                                            <span id="zhi">===请选择===</span>
                                            </button>
                                        </span>
                                        <div id="a" class="duoxuan" style="position:absolute; height:300px; overflow:auto">
                                            <ul id="renyuan" class="ui-multiselect-checkboxes ui-helper-reset">
                                                <foreach name="u_map.admin" item="list" key="k">
                                                <li>
                                                    <label class="ui-corner-all" for="ui-multiselect-select_dx-option-0">
                                                        <input id="{$list}" class="checkk" type="checkbox" name="slr[1][]" value="{$k}" <foreach name="d_list.1" item="li" key="k1"><if condition="$k eq $k1">checked="checked"</if></foreach>>
                                                        <span>{$list}</span>
                                                    </label>
                                                </li>
                                                </foreach>
                                            </ul>
                                        </div>
                                    </div>
                                    <div>
                                        <font>UI设计：</font>
                                        <span>
                                            <select class="required select_dx" id ="ui" name="slr[2][]">
                                            <option value="">===请选择===</option>
                                            <foreach name="u_map.admin" item="list" key="k">
                                                <option value="{$k}" <foreach name="d_list.2" item="li" key="k1"><if condition="$k eq $k1">selected="selected"</if></foreach>>{$list}</option>
                                            </foreach>
                                            </select>
                                        </span>
                                    </div>
                                    <div>
                                        <font>前端html：</font>
                                        <span>
                                            <select class="required select_dx" id ="html" name="slr[3][]">
                                            <option value="">===请选择===</option>
                                            <foreach name="u_map.admin" item="list" key="k">
                                                <option value="{$k}" <foreach name="d_list.3" item="li" key="k1"><if condition="$k eq $k1">selected="selected"</if></foreach>>{$list}</option>
                                            </foreach>
                                            </select>
                                        </span>
                                    </div>
                                    <div>
                                        <font>新需求开发：</font>
                                        <span>
                                            <button id="cc" class="ui-multiselect ui-widget ui-state-default ui-corner-all xinxuq" type="button" aria-haspopup="true" style="min-width: 225px;height:28px;overflow:hidden;">
                                            <span class="ui-icon ui-icon-triangle-1-s"></span>
                                            <span id="kf_zhi">===请选择===</span>
                                            </button>
                                        </span>
                                        <div id="aa" class="duoxuan" style="position:absolute; height:300px; overflow:auto;top:677px;">
                                            <ul id="renyuan" class="ui-multiselect-checkboxes ui-helper-reset">
                                                <foreach name="u_map.admin" item="list" key="k">
                                                <li>
                                                    <label class="ui-corner-all" for="ui-multiselect-select_dx-option-0">
                                                        <input id="{$list}" class="checkk" type="checkbox" name="slr[4][]" value="{$k}" <foreach name="d_list.4" item="li" key="k1"><if condition="$k eq $k1">checked="checked"</if></foreach>>
                                                        <span>{$list}</span>
                                                    </label>
                                                </li>
                                                </foreach>
                                            </ul>
                                        </div>
                                    </div>
                                    <div>
                                        <font>功能测试：</font>
                                        <span>
                                            <select class="required select_dx" id ="cs" name="slr[5][]">
                                            <option value="">===请选择===</option>
                                            <foreach name="u_map.admin" item="list" key="k">
                                                <option value="{$k}" <foreach name="d_list.5" item="li" key="k1"><if condition="$k eq $k1">selected="selected"</if></foreach>>{$list}</option>
                                            </foreach>
                                            </select>
                                        </span>
                                    </div>
                                    <div>
                                        <font>上线确认：</font>
                                        <font>开发主管：</font>
                                        <span>
                                            <select class="required select_dx" id ="kfzg" name="mast_develop">
                                            <option value="">===请选择===</option>
                                            <volist name="u_map.admin" id="list">
                                            <option value="{$key}" <if condition="$edit_info.mast_develop eq $key">selected="selected"</if>>{$list}</option>
                                            </volist>
                                            </select>
                                        </span>
                                        <p>
                                        <font>产品主管：</font>
                                        <span>
                                            <select class="required select_dx" id ="cpzg" name="mast_product">
                                            <option value="">===请选择===</option>
                                            <volist name="u_map.admin" id="list">
                                            <option value="{$key}" <if condition="$edit_info.mast_product eq $key">selected="selected"</if>>{$list}</option>
                                            </volist>
                                            </select>
                                        </span>
                                        </p>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>提交时间：</th>
                                <td>{$edit_info.add_time}</td>
                            </tr>
                            <tr>
                                <th>最终上线时间：</th>
                                <td><if condition="$edit_info.last_online eq ''">---
                                <else />
                                {$edit_info.last_online_ex}
                                </if></td>
                            </tr>
                        </tbody>
                    </table>
                </form>
            </div>
            <div class="result-content" id="fankui">
                    <table class="insert-tab" width="100%">
                        <tbody>
                            <tr>
                                <th colspan="2">
                                    <h1 class="xiangq">反馈</h1>
                                </th>
                            </tr>
                            <tr>
                                <th width="120">反馈记录：</th>
                                <td>
                                    <div class="content" id="ajax_lists"></div>                                    
                                </td>
                            </tr>
                            <tr>
                                <th>新需求确认：</th>
                                <td>
                                    <form name="theForm_xq" autocomplete="off" id="theForm_xq" action="__URL__/feedback" method="post">
                                        <input type="hidden" id="position_id" name="position_id" value="1">
                                        <input type="hidden" id="demand_id" name="demand_id" value="{$edit_info.id}">
                                        新版本交付：
                                        <input type="submit" name="submit" id="submit_xq" value="确认交付" />
                                        <span class="fankuisp">产品经理：
                                        <volist name="d_list.1" id="list">
                                            {$list}　
                                        </volist>
                                        </span>
                                    </form>
                                </td>
                            </tr>
                            <tr>
                                <th>UI设计：</th>
                                <td>
                                    <form name="theForm_ui" autocomplete="off" id="theForm_ui" action="__URL__/feedback" method="post">
                                        <input type="hidden" id="position_id" name="position_id" value="2">
                                        <input type="hidden" id="demand_id" name="demand_id" value="{$edit_info.id}">
                                        新版本交付：
                                        <input type="submit" name="submit" id="submit_ui" value="确认交付" />
                                        <span class="fankuisp">UI设计：
                                        <volist name="d_list.2" id="list">
                                            {$list}　
                                        </volist>
                                        </span>
                                    </form>
                                </td>
                            </tr>
                            <tr>
                                <th>html处理：</th>
                                <td>
                                    <form name="theForm_html" autocomplete="off" id="theForm_html" action="__URL__/feedback" method="post">
                                        <input type="hidden" id="position_id" name="position_id" value="3">
                                        <input type="hidden" id="demand_id" name="demand_id" value="{$edit_info.id}">
                                        新版本交付：
                                        <input type="submit" name="submit" id="submit_html" value="确认交付" />
                                        <span class="fankuisp">前端：
                                        <volist name="d_list.3" id="list">
                                            {$list}　
                                        </volist>
                                        </span>
                                    </form>
                                </td>
                            </tr>
                            <tr>
                                <th>新需求开发：</th>
                                <td>
                                    <form name="theForm_kf" autocomplete="off" id="theForm_kf" action="__URL__/feedback" method="post">
                                        <input type="hidden" id="position_id" name="position_id" value="4">
                                        <input type="hidden" id="demand_id" name="demand_id" value="{$edit_info.id}">
                                        测试版交付：
                                        <input type="submit" name="submit" id="submit_kf" value="确认交付" />
                                        <span class="fankuisp">开发：
                                        <volist name="d_list.4" id="list">
                                            {$list}　
                                        </volist>
                                        </span>
                                    </form>
                                </td>
                            </tr>
                            <tr>
                                <th>功能测试：</th>
                                <td>
                                    <form name="theForm_cs" autocomplete="off" id="theForm_cs" action="__URL__/feedback" method="post" enctype="multipart/form-data">
                                        <div>
                                            终板交付<span class="fankuisp">测试：
                                            <volist name="d_list.5" id="list">
                                                {$list}　
                                            </volist>
                                            </span>
                                        </div>
                                        <div>
                                            <font>是否延迟：</font>
                                            <span class="xuanze">
                                            <input type="radio" name="delay" value="1" checked="checked"/> 否
                                            </span>
                                            <span class="xuanze">
                                            <input type="radio" name="delay" value="2" /> 是
                                            </span>
                                        </div>
                                        <div>
                                            <font>延迟原因：</font>
                                            <textarea style="width:80%" class="wtms" name="ycyy" id="ycyy"></textarea>
                                        </div>
                                        <div style="margin:10px 5px 5px 90px;">
                                        <input type="hidden" id="position_id" name="position_id" value="5">
                                        <input type="hidden" id="demand_id" name="demand_id" value="{$edit_info.id}">
                                        <input class="btn" value="确认交付" id="submit_cs" name="submit" type="submit">
                                        </div>
                                    </form>
                                </td>
                            </tr>
                            <tr>
                                <th rowspan="2">上线确认：</th>
                                <td>
                                    <form name="theForm_kfzg" autocomplete="off" id="theForm_kfzg" action="__URL__/feedback_qr" method="post" enctype="multipart/form-data">
                                    <input type="hidden" id="position_id" name="position_id" value="6">
                                    <input type="hidden" id="demand_id" name="demand_id" value="{$edit_info.id}">
                                    <input type="hidden" name="zg_name" value="开发主管">
                                    <input type="hidden" name="mast_develop" value="{$edit_info.mast_develop}">
                                    <input type="hidden" name="mast_product" value="{$edit_info.mast_product}">
                                    开发主管：<input type="submit" name="submit_kfzg" id="submit_kfzg" value="确认交付" />
                                    <span class="fankuisp">确认人：{$u_map['admin'][$edit_info['mast_develop']]}</span>
                                    </form>
                                </td>                                
                            </tr>
                            <tr>
                                <td>
                                    <form name="theForm_cpzg" autocomplete="off" id="theForm_cpzg" action="__URL__/feedback_qr" method="post" enctype="multipart/form-data">
                                    <input type="hidden" id="position_id" name="position_id" value="6">
                                    <input type="hidden" id="demand_id" name="demand_id" value="{$edit_info.id}">
                                    <input type="hidden" name="zg_name" value="产品主管">
                                    <input type="hidden" name="mast_develop" value="{$edit_info.mast_develop}">
                                    <input type="hidden" name="mast_product" value="{$edit_info.mast_product}">
                                    产品主管：<input type="submit" name="submit_cpzg" id="submit_cpzg" value="确认交付" />
                                    <span class="fankuisp">确认人：{$u_map['admin'][$edit_info['mast_product']]}</span>
                                    </form>
                                </td>                                
                            </tr>
                        </tbody>
                    </table>
            </div>
        </div>

    </div>
    <!--/main-->
</div>
</body>
<script type="text/javascript">
    //日期皮肤
    !function(){
        laydate.skin('molv');//切换皮肤，请查看skins下面皮肤库
        laydate({elem: '#demo'});//绑定元素
    }();
    $(function(){
        //区域选中
        $(".xuanze, .xuanze_ex").click(function(){
            $(this).find("input[type=radio]").attr("checked", 'checked');
        });
    });
    $(function(){
        var statuss = "{$edit_info.status}";
        //基本详情修改
        $("#jbxq_edit_ex").click(function() {
            var objButton      = $(this);
            var description    = $('#description').val();
                description    = $.trim(description);
            var level          = $('#level').val();
            var project_id     = $('#project_id').val();
            // var zhi            = $('#zhi').html();
            // var html           = $('#html').val();
            // var kf_zhi         = $('#kf_zhi').html();
            // var cs             = $('#cs').val();
            // var kfzg           = $('#kfzg').val();
            // var cpzg           = $('#cpzg').val();
            if (description == "") {
                mh_dialogShow('mh_warning','需求描述不能为空！',2,true); 
                return false;
            } 
            if (level == "") {
                mh_dialogShow('mh_warning','请选择优先级！',2,true); 
                return false;
            } 
            if (project_id == "") {
                mh_dialogShow('mh_warning','请选择所属项目！',2,true); 
                return false;
            }
            // if (zhi == "===请选择===") {
            //     mh_dialogShow('mh_warning','请选择新需求确认！',2,true); 
            //     return false;
            // } 
            // if(html == ""){
            //     mh_dialogShow('mh_warning','请选择前端html！',2,true); 
            //     return false;
            // } 
            // if(kf_zhi == "===请选择==="){
            //     mh_dialogShow('mh_warning','请选择新需求开发！',2,true); 
            //     return false;
            // }
            // if(cs == ""){
            //     mh_dialogShow('mh_warning','请选择功能测试！',2,true); 
            //     return false;
            // }
            // if(kfzg == ""){
            //     mh_dialogShow('mh_warning','请选择开发主管！',2,true); 
            //     return false;
            // }
            // if(cpzg == ""){
            //     mh_dialogShow('mh_warning','请选择产品主管！',2,true); 
            //     return false;
            // } 
            var options = {
                beforeSend:function(){
                    objButton.val('保存').attr('disabled',true);
                },
                success: function (data) {
                  if (data) {
                    if (data == 0) {
                        alert('修改成功！');
                        init();
                        return false;
                    }else if(data == -1){
                        alert('修改失败！');   
                        return false;
                    }else if(data == 100){
                        top.location.href="__APP__/Login/index.html"
                        return false;
                    }else{
                        alert('修改失败！');   
                        return false;
                    }
                  }
                },
                complete:function(){
                    objButton.val('保存').attr('disabled',false);
                }
            };
            $("#theForm_jbxq").ajaxForm(options);
        });

        //新需求确认
        $("#submit_xq").click(function() {
            var objButton = $(this);
            if (statuss == 7) {
                alert('项目已上线，禁止操作！');
                return false;
            }
            var result    = confirm("确认交付新版本？");
            if (result == false) {
                return false;
            }
            var options = {
                beforeSend:function(){
                    objButton.val('确认交付').attr('disabled',true);
                },
                success: function (data) {
                  if (data) {
                    if (data == 0) {
                        alert('提交成功！');
                        init();
                        return false;
                    }else if(data == -1){
                        alert('提交失败！');   
                        return false;
                    }else if(data == 100){
                        top.location.href="__APP__/Login/index.html"
                        return false;
                    }else if(data == -5){
                        alert('你没有操作权限！');   
                        return false;
                    }else{
                        alert('提交失败！');   
                        return false;
                    }
                  }
                },
                complete:function(){
                    objButton.val('确认交付').attr('disabled',false);
                }
            }; 
            $("#theForm_xq").ajaxForm(options);
        });
        //UI设计
        $("#submit_ui").click(function() {
            var objButton = $(this);
            if (statuss == 7) {
                alert('项目已上线，禁止操作！');
                return false;
            }
            var result    = confirm("确认交付新版本？");
            if (result == false) {
                return false;
            }
            var options = {
                beforeSend:function(){
                    objButton.val('确认交付').attr('disabled',true);
                },
                success: function (data) {
                  if (data) {
                    if (data == 0) {
                        alert('提交成功！');
                        init();
                        return false;
                    }else if(data == -1){
                        alert('提交失败！');   
                        return false;
                    }else if(data == 100){
                        top.location.href="__APP__/Login/index.html"
                        return false;
                    }else if(data == -5){
                        alert('你没有操作权限！');   
                        return false;
                    }else{
                        alert('提交失败！');   
                        return false;
                    }
                  }
                },
                complete:function(){
                    objButton.val('确认交付').attr('disabled',false);
                }
            }; 
            $("#theForm_ui").ajaxForm(options);
        });
        //html处理
        $("#submit_html").click(function() {
            var objButton = $(this);
            if (statuss == 7) {
                alert('项目已上线，禁止操作！');
                return false;
            }
            var result    = confirm("确认交付新版本？");
            if (result == false) {
                return false;
            }
            var options = {
                beforeSend:function(){
                    objButton.val('确认交付').attr('disabled',true);
                },
                success: function (data) {
                  if (data) {
                    if (data == 0) {
                        alert('提交成功！');
                        init();
                        return false;
                    }else if(data == -1){
                        alert('提交失败！');   
                        return false;
                    }else if(data == 100){
                        top.location.href="__APP__/Login/index.html"
                        return false;
                    }else if(data == -5){
                        alert('你没有操作权限！');   
                        return false;
                    }else{
                        alert('提交失败！');   
                        return false;
                    }
                  }
                },
                complete:function(){
                    objButton.val('确认交付').attr('disabled',false);
                }
            }; 
            $("#theForm_html").ajaxForm(options);
        });
        //新需求开发
        $("#submit_kf").click(function() {
            var objButton = $(this);
            if (statuss == 7) {
                alert('项目已上线，禁止操作！');
                return false;
            }
            var result    = confirm("确认交付新版本？");
            if (result == false) {
                return false;
            }
            var options = {
                beforeSend:function(){
                    objButton.val('确认交付').attr('disabled',true);
                },
                success: function (data) {
                  if (data) {
                    if (data == 0) {
                        alert('提交成功！');
                        init();
                        return false;
                    }else if(data == -1){
                        alert('提交失败！');   
                        return false;
                    }else if(data == 100){
                        top.location.href="__APP__/Login/index.html"
                        return false;
                    }else if(data == -5){
                        alert('你没有操作权限！');   
                        return false;
                    }else{
                        alert('提交失败！');   
                        return false;
                    }
                  }
                },
                complete:function(){
                    objButton.val('确认交付').attr('disabled',false);
                }
            };  
            $("#theForm_kf").ajaxForm(options);
        });
        //功能测试
        $("#submit_cs").click(function() {
            var objButton = $(this);
            var status    = $('input[name="delay"]:checked').val();
            var ycyy      = $('#ycyy').val();
            if (statuss == 7) {
                alert('项目已上线，禁止操作！');
                return false;
            }
            var result    = confirm("确认交付新版本？");
            if (result == false) {
                return false;
            }
            if (status == "2") {
                if (ycyy == "") {
                    mh_dialogShow('mh_warning','延迟原因不能为空！',2,true); 
                    return false;
                }    
            }
            var options = {
                beforeSend:function(){
                    objButton.val('确认交付').attr('disabled',true);
                },
                success: function (data) {
                  if (data) {
                    if (data == 0) {
                        alert('提交成功！');
                        init();
                        return false;
                    }else if(data == -1){
                        alert('提交失败！');   
                        return false;
                    }else if(data == 100){
                        top.location.href="__APP__/Login/index.html"
                        return false;
                    }else if(data == -5){
                        alert('你没有操作权限！');   
                        return false;
                    }else{
                        alert('提交失败！');   
                        return false;
                    }
                  }
                },
                complete:function(){
                    objButton.val('确认交付').attr('disabled',false);
                }
            };   
            $("#theForm_cs").ajaxForm(options);
        });
        //开发主管上线确认
        $("#submit_kfzg").click(function() {
            var objButton = $(this);
            var mast_develop = "{$edit_info.mast_develop}";
            var user_id      = "{$user_id}";
            if (statuss == 7) {
                alert('项目已上线，禁止操作！');
                return false;
            }
            if (mast_develop != user_id) {
                alert('你没有操作权限！');   
                return false;
            }
            var result    = confirm("确认上线吗？");
            if (result == false) {
                return false;
            }
            var options = {
                beforeSend:function(){
                    objButton.val('确认交付').attr('disabled',true);
                },
                success: function (data) {
                  if (data) {
                    if (data == 0) {
                        alert('提交成功！');
                        init();
                        return false;
                    }else if(data == -1){
                        alert('提交失败！');   
                        return false;
                    }else if(data == 100){
                        top.location.href="__APP__/Login/index.html"
                        return false;
                    }else if(data == -5){
                        alert('你没有操作权限！');   
                        return false;
                    }else{
                        alert('提交失败！');   
                        return false;
                    }
                  }
                },
                complete:function(){
                    objButton.val('确认交付').attr('disabled',false);
                }
            };  
            $("#theForm_kfzg").ajaxForm(options);
        });
        //产品主管上线确认
        $("#submit_cpzg").click(function() {
            var objButton = $(this);
            var mast_product = "{$edit_info.mast_product}";
            var user_id      = "{$user_id}";
            if (statuss == 7) {
                alert('项目已上线，禁止操作！');
                return false;
            }
            if (mast_product != user_id) {
                alert('你没有操作权限！');   
                return false;
            }
            var result    = confirm("确认上线吗？");
            if (result == false) {
                return false;
            }
            var options = {
                beforeSend:function(){
                    objButton.val('确认交付').attr('disabled',true);
                },
                success: function (data) {
                  if (data) {
                    if (data == 0) {
                        alert('提交成功！');
                        init();
                        return false;
                    }else if(data == -1){
                        alert('提交失败！');   
                        return false;
                    }else if(data == 100){
                        top.location.href="__APP__/Login/index.html"
                        return false;
                    }else if(data == -5){
                        alert('你没有操作权限！');   
                        return false;
                    }else{
                        alert('提交失败！');   
                        return false;
                    }
                  }
                },
                complete:function(){
                    objButton.val('确认交付').attr('disabled',false);
                }
            };  
            $("#theForm_cpzg").ajaxForm(options);
        });
    });
</script>
</html>